<!DOCTYPE html>
    <html lang="zh-cn">
    <head>
    <meta charset="utf-8"/>
    <title>
    <meta name="authors" content="" />perforce server的Linux的安装</title></head><body>From:<a href=http://www.cnblogs.com/itech/archive/2011/08/19/2146058.html>http://www.cnblogs.com/itech/archive/2011/08/19/2146058.html</a><br><br><div><p>&#160;</p>&#13;
<p>perforce&#30340;Linux&#30340;&#23433;&#35013;</p>&#13;
<p>&#160;</p>&#13;
<p>&#19968; &#23433;&#35013;&#21069;&#37197;&#32622;</p>&#13;
<p>1) &#26426;&#22120;&#37197;&#32622;</p>&#13;
<p>&#20462;&#25913;&#26426;&#22120;&#21517;</p>&#13;
<p>&#30003;&#35831;&#38745;&#24577;ip&#21644;dns&#19978;&#27492;ip&#21040;&#26426;&#22120;&#21517;&#30340;&#26144;&#23556;&#12290;</p>&#13;
<p>&#160;</p>&#13;
<p>2) &#29992;&#25143;&#37197;&#32622;</p>&#13;
<p>&#22312;root&#19979;&#21019;&#24314;&#29992;&#25143;&#32452;&#65292;&#29992;&#25143;&#21644;&#25152;&#22312;&#30340;home&#30446;&#24405;&#12290;</p>&#13;
<p>&#21019;&#24314;perforce group &#65306;</p>&#13;
<p>&#160; /usr/sbin/groupadd perforceg</p>&#13;
<p>&#21019;&#24314;perforce user&#65306;</p>&#13;
<p>&#160; mkdir /local</p>&#13;
<p>&#160; mkdir /local/perforce</p>&#13;
<p>&#160; /usr/sbin/useradd -m -d /local/perforce -g perforceg perforce</p>&#13;
<p>&#20462;&#25913;perforce user&#30340;&#23494;&#30721;&#65306;</p>&#13;
<p>&#160; /usr/bin/passwd perforce&#160; (&#36755;&#20837;123)</p>&#13;
<p>&#26597;&#30475;&#21019;&#24314;&#30340;&#29992;&#25143;perforce&#30340;&#20449;&#24687;&#65306;</p>&#13;
<p>id perforce<br>uid=504(perforce) gid=504(perforceg) groups=504(perforceg)</p>&#13;
<p>&#20462;&#25913;home&#30446;&#24405;&#30340;owner&#65306;</p>&#13;
<p>chown perforce:perforceg /local/perforce</p>&#13;
<p>&#160;</p>&#13;
<p>3) perforce server &#30340;&#30446;&#24405;</p>&#13;
<p>su - perforce</p>&#13;
<p>mkdir /local/perforce/p4root</p>&#13;
<p>mkdir /local/perforce/log</p>&#13;
<p>mkdir /local/perforce/journal</p>&#13;
<p>[&#36890;&#24120;&#22320;p4root&#65292;log&#65292;journal&#38656;&#35201;&#25346;&#36733;&#21040;&#19981;&#21516;&#30340;&#29289;&#29702;&#30828;&#30424;&#65292;&#26469;&#36991;&#20813;&#28798;&#38590;&#20107;&#25925;&#30340;&#24433;&#21709;]</p>&#13;
<p>&#160;</p>&#13;
<p>4&#65289;&#35774;&#32622;&#29992;&#25143;&#30340;su&#21644;sudo&#20026;&#19981;&#38656;&#35201;&#23494;&#30721;</p>&#13;
<p>&#21442;&#32771;&#65306;<a id="ctl03_TitleUrl" href="http://www.cnblogs.com/itech/archive/2009/08/07/1541017.html">&#35774;&#32622;su&#21644;sudo&#20026;&#19981;&#38656;&#35201;&#23494;&#30721;</a></p>&#13;
<p>&#160;</p>&#13;
<p>&#20108;&#160;&#19979;&#36733;&#21644;&#23433;&#35013;</p>&#13;
<p>0) &#23433;&#35013;&#22909;&#21518;&#30340;&#25991;&#20214;&#21644;&#30446;&#24405;&#22914;&#19979;&#65306; </p>&#13;
<p>-bash-3.2$ pwd<br>/local/perforce<br>-bash-3.2$ ls -l<br>&#24635;&#35745; 3120<br>drwxr-xr-x 2 perforce perforceg&#160;&#160;&#160; 4096 2011-02-15 Desktop<br>drwxr-xr-x 2 perforce perforceg&#160;&#160;&#160; 4096 08-18 19:01 journal<br>drwxr-xr-x 2 perforce perforceg&#160;&#160;&#160; 4096 08-18 18:51 log<br>-rwxr-xr-x 1 perforce perforceg&#160; 777652 08-18 18:37 p4<br>-rwxr-xr-x 1 perforce perforceg 2381536 08-18 18:45 p4d<br>drwxr-xr-x 2 perforce perforceg&#160;&#160;&#160; 4096 08-19 13:02 p4root<br>-rwxr-xr-x 1 perforce perforceg&#160;&#160;&#160;&#160; 982 08-19 13:39 p4server001<br>-rw-r--r-- 1 perforce perforceg&#160;&#160;&#160;&#160; 366 08-19 13:28 p4server001.ini</p>&#13;
<p>&#160;</p>&#13;
<p>1&#65289;&#23433;&#35013;</p>&#13;
<p>&#22312;perforce&#30340;download&#39029;&#38754;&#19978;&#25214;&#21040;P4D&#21644;p4&#30340;Linux&#19979;&#36733;&#25991;&#20214;&#12290;</p>&#13;
<p>chmod +x p4d</p>&#13;
<p>chmod +x p4 </p>&#13;
<p>&#23558;p4d&#21644;p4&#25335;&#36125;&#21040;/local/perforce&#19979;</p>&#13;
<p>&#160;</p>&#13;
<p>2&#65289;p4d&#30340;&#37197;&#32622;&#25991;&#20214; </p>&#13;
<br>&#13;
<p><p>#</p><p>&#160;This&#160;will&#160;be&#160;configure&#160;file&#160;</p><p>for</p><p>&#160;p4&#160;server</p><p>,</p><p><br></p><p>#</p><p>&#160;and&#160;it&#160;need&#160;be&#160;</p><p>$</p><p>USERHOME</p><p>/$</p><p>P4SERVERNAME</p><p>.</p><p>ini<br>USER</p><p>=</p><p>perforce<br>USERHOME</p><p>=/</p><p>local</p><p>/</p><p>perforce<br><br>P4USER</p><p>=</p><p>perforce<br>P4PASSWD</p><p>=</p><p>123</p><p><br>P4SERVERNAME</p><p>=</p><p>p4server001<br><br>p4</p><p>=$</p><p>USERHOME</p><p>/</p><p>p4<br>p4d</p><p>=$</p><p>USERHOME</p><p>/</p><p>p4d<br><br>P4PORT</p><p>=</p><p>10.148</p><p>.</p><p>151.98</p><p>:</p><p>1666</p><p><br>P4ROOT</p><p>=$</p><p>USERHOME</p><p>/</p><p>p4root<br>JOURNAL</p><p>=$</p><p>USERHOME</p><p>/</p><p>journal</p><p><br>LOG</p><p>=$</p><p>USERHOME</p><p>/</p><p>log</p><p>/</p><p>p4server001</p><p>.</p><p>log<br><br>TRACKLEVEL</p><p>=</p><p>1</p><p><br>SERVERLEVEL</p><p>=</p><p>2</p></p>&#13;
<br>3) &#21551;&#21160;&#33050;&#26412;/local/perforce/p4server001,&#23558;p4server001&#25335;&#36125;&#21040;/etc/init.d&#19979;&#65292;&#21629;&#20196;&#20026;cp /local/perforce/p4server001 /etc/init.d/&#12290;<p>/local/perforce/p4server001.ini3) &#21551;&#21160;&#33050;&#26412;/local/perforce/p4server001,&#23558;p4server001&#25335;&#36125;&#21040;/etc/init.d&#19979;&#65292;&#21629;&#20196;&#20026;cp /local/perforce/p4server001 /etc/init.d/&#12290;</p><p>&#21442;&#32771;&#65306;http://www.xueai.org/2010/11/110.html </p>&#13;
<p><p>#</p><p>!</p><p>/</p><p>bin</p><p>/</p><p>bash<br></p><p>#</p><p><br></p><p>#</p><p>&#160;chkconfig:</p><p>1235</p><p>&#160;</p><p>80</p><p>&#160;</p><p>80</p><p><br></p><p>#</p><p>&#160;description:&#160;p4server001&#160;daemon<br></p><p>#</p><p><br><br></p><p>PATH</p><p>=/</p><p>sbin:</p><p>/</p><p>bin:</p><p>/</p><p>usr</p><p>/</p><p>bin:</p><p>/</p><p>usr</p><p>/</p><p>sbin<br><br></p><p>#</p><p>&#160;Source&#160;in&#160;the&#160;configs</p><p>...</p><p><br></p><p>.</p><p>&#160;</p><p>/</p><p>local</p><p>/</p><p>perforce</p><p>/</p><p>p4server001</p><p>.</p><p>ini<br><br>SU</p><p>=</p><p>"</p><p>su&#160;$USER&#160;-c</p><p>"</p><p><br>LOCKFILE</p><p>=$</p><p>USERHOME</p><p>/$</p><p>P4SERVERNAME</p><p>.</p><p>lock<br><br></p><p>start</p><p>()</p><p>&#160;{<br>&#160;&#160;&#160;&#160;STARTCMD</p><p>=</p><p>"</p><p>$p4d&#160;-d&#160;-v&#160;server=$SERVERLEVEL,track=$TRACKLEVEL&#160;-p&#160;$P4PORT&#160;-r&#160;$P4ROOT&#160;-L&#160;$LOG&#160;-J&#160;$JOURNAL</p><p>"</p><p><br>&#160;&#160;&#160;&#160;</p><p>$</p><p>SU&#160;</p><p>"</p><p>$STARTCMD</p><p>"</p><p>&#160;</p><p>2</p><p>&gt;</p><p>&amp;</p><p>1</p><p><br>&#160;&#160;&#160;&#160;touch&#160;</p><p>$</p><p>LOCKFILE<br>&#160;&#160;&#160;&#160;</p><p>$</p><p>SU&#160;</p><p>"</p><p>logger&#160;p4d&#160;starting</p><p>"</p><p><br>&#160;&#160;&#160;&#160;</p><p>echo</p><p>&#160;</p><p>"</p><p>p4d&#160;was&#160;started&#160;on</p><p>"</p><p>&#160;`hostname&#160;-s`<br>}<br><br>stop</p><p>()</p><p>&#160;{<br>&#160;&#160;&#160;&#160;STOPCMD</p><p>=</p><p>"</p><p>$p4&#160;-p&#160;$P4PORT&#160;-u&#160;$P4USER&#160;admin&#160;stop</p><p>"</p><p><br>&#160;&#160;&#160;&#160;</p><p>echo</p><p>&#160;</p><p>$</p><p>P4PASSWD&#160;|&#160;</p><p>$</p><p>p4&#160;-p&#160;</p><p>$</p><p>P4PORT&#160;-u&#160;</p><p>$</p><p>P4USER&#160;login<br>&#160;&#160;&#160;&#160;</p><p>$</p><p>SU&#160;</p><p>"</p><p>$STOPCMD</p><p>"</p><p>&#160;</p><p>2</p><p>&gt;</p><p>&amp;</p><p>1</p><p><br>&#160;&#160;&#160;&#160;rm&#160;</p><p>$</p><p>LOCKFILE<br>&#160;&#160;&#160;&#160;</p><p>$</p><p>SU&#160;</p><p>"</p><p>logger&#160;p4d&#160;stopping</p><p>"</p><p><br>&#160;&#160;&#160;&#160;</p><p>echo</p><p>&#160;</p><p>"</p><p>p4d&#160;was&#160;stopped&#160;on</p><p>"</p><p>&#160;`hostname&#160;-s`<br>}<br><br>status</p><p>()</p><p>&#160;{<br>&#160;&#160;&#160;&#160;</p><p>if</p><p>&#160;[&#160;-f&#160;</p><p>$</p><p>LOCKFILE&#160;]</p><p>;</p><p><br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;</p><p>then</p><p><br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;</p><p>echo</p><p>&#160;p4d&#160;status:&#160;running<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;</p><p>else</p><p><br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;</p><p>echo</p><p>&#160;p4d&#160;status:&#160;stopped<br>&#160;&#160;&#160;&#160;fi<br>}<br><br>case&#160;</p><p>"</p><p>$1</p><p>"</p><p>&#160;in<br><br>'</p><p>start</p><p>'</p><p>)</p><p><br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;</p><p>start</p><p><br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;</p><p>;;</p><p><br><br>'stop'</p><p>)</p><p><br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;stop<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;</p><p>;;</p><p><br><br>'status'</p><p>)</p><p><br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;status<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;</p><p>;;</p><p><br>*</p><p>)</p><p><br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;</p><p>echo</p><p>&#160;</p><p>"</p><p>Usage:&#160;p4server001&#160;{&#160;start&#160;|&#160;stop&#160;|&#160;status&#160;}</p><p>"</p><p><br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;</p><p>;;</p><p><br><br>esac</p></p>&#13;
<p>&#160;</p>&#13;
<p>4&#65289; &#21551;&#21160;p4d </p>&#13;
<p>$su - perforce<br>-bash-3.2$ /etc/init.d/p4server001 start<br>Perforce Server starting...<br>p4d was started on machinie</p>&#13;
<p>&#160;</p>&#13;
<p>&#20063;&#21487;&#20197;&#20351;&#29992;&#21629;&#20196;&#26469;&#21551;&#21160;&#65306;<br>/sbin/service p4server001 start </p>&#13;
<br>&#13;
<p>5&#65289; &#26597;&#30475; </p>&#13;
<p>/etc/init.d/p4server001 status<br>p4d status: running<br>&#25110;</p>&#13;
ps -ef | grep p4d <br>&#13;
<p>perforce  30898&#160;&#160;&#160;&#160; 1&#160; 0 14:04 ?&#160;&#160;&#160;&#160;&#160;&#160;&#160; 00:00:00 /local/perforce/p4d -d -v  server=2,track=1 -p 10.148.151.98:1666 -r /local/perforce/p4root -L  /local/perforce/log/p4server001.log -J /local/perforce/journal/journal</p>&#13;
<p>ps -ef | grep p4d</p><p>&#160;</p>&#13;
<p>&#33267;&#27492;&#21487;&#20197;&#22312;&#36828;&#31243;&#30340;&#26426;&#22120;&#19978;&#20351;&#29992;p4v&#25110;p4&#26469;&#35775;&#38382;&#27492;p4server&#20102;&#12290; </p>&#13;
&#160;&#13;
<p>&#19977; &#20248;&#21270; </p>&#13;
<p>1) &#37197;&#32622;&#20026;daemon&#65292;&#24403;&#26426;&#22120;&#37325;&#21551;&#21518;&#33021;&#33258;&#21160;&#36816;&#34892;</p>&#13;
<p>&#20351;&#29992;chkconfig&#65292;&#33050;&#26412;&#21069;&#24517;&#39035;&#26377;&#22914;&#19979;&#30340;&#34892;&#65306;</p>&#13;
<p>#!/bin/bash<br># <br># chkconfig:1235 80 80<br># description: p4server001 daemon<br>#</p>&#13;
&#160;&#13;
<p>&#23433;&#35013;chkconfig&#65292;&#21629;&#20196;&#20026;yum install chkconfig</p>&#13;
<p>&#23558;&#19978;&#38754;&#30340;p4server001&#37197;&#32622;&#20026;daemon&#65292;&#21629;&#20196;&#20026;&#65306;</p>&#13;
<p>su -</p>&#13;
<p>/sbin/chkconfig --add p4server001 </p>&#13;
<p>&#160;</p>&#13;
<p>&#23433;&#35013;&#21518;&#26597;&#30475;&#65306;</p>&#13;
<p>/sbin/chkconfig --list | grep p4server001</p>&#13;
<p>p4server001&#160;&#160;&#160;&#160; 0:&#20851;&#38381;&#160; 1:&#21551;&#29992;&#160; 2:&#21551;&#29992;&#160; 3:&#21551;&#29992;&#160; 4:&#20851;&#38381;&#160; 5:&#21551;&#29992;&#160; 6:&#20851;&#38381;</p>&#13;
<br>&#13;
<p>&#22235; &#37197;&#32622;inetd &#25110;xinetd&#65292; &#20351;p4 server&#21482;&#26377;&#26377;request&#30340;&#26102;&#20505;&#25165;&#21551;&#21160;,&#38656;&#35201;&#20351;&#29992;p4d &#30340;-i&#21442;&#25968;&#25903;&#25345;inetd&#65292;&#22914;&#26524;&#20351;&#29992;inetd&#25110;xinetd&#65292;&#21017;&#19981;&#38656;&#35201;&#21069;&#38754;&#30340;daemon&#30340;&#37197;&#32622;&#20102;&#65292;&#22240;&#20026;&#19981;&#38656;&#35201;p4d&#22312;&#26426;&#22120;&#21551;&#21160;&#30340;&#26102;&#20505;&#23601;&#21551;&#21160;&#12290;</p>&#13;
<br>http://kb.perforce.com/article/45/running-a-perforce-server-from-inetd-on-unix<br>&#13;
<p>http://hints.macworld.com/article.php?story=20041112174525470</p>&#13;
<p>&#21442;&#32771;&#65306;http://kb.perforce.com/article/45/running-a-perforce-server-from-inetd-on-unix</p><p>&#160;</p>&#13;
<p><code>&#22312;&#25991;&#20214;&#20013;/etc/services</code>&#20013;&#22686;&#21152;:<br>p4server001 1666/tcp </p>&#13;
<p>&#160;</p>&#13;
<pre><code>#netview-aix-6   1666/udp   # netview-aix-6 <br>p4server001        1666/tcp   # Perforce Server <br>#netview-aix-6   1666/tcp  # netview-aix-6</code></pre>&#13;
<p>&#160;</p>&#13;
<p>&#28982;&#21518;&#21019;&#24314;<code>/etc/xinetd.d/p4server001</code>&#65292;&#19988;&#20869;&#23481;&#20026;&#65306;</p>&#13;
<p>service p4server001<br>{<br>&#160; socket_type = stream<br>&#160; wait = no<br>&#160; user = perforce<br>&#160; server = /local/perforce/p4d<br>&#160; server_args = -i -L /local/perforce/log/p4server001.log -r /local/perforce/p4root -p 10.148.151.98:1888 -J /local/perforce/journal/journal<br>&#160; disable = no<br>}&#160;</p>&#13;
<p>&#160;</p>&#13;
<p>&#21487;&#20197;&#22312;&#36828;&#31243;&#30340;&#26426;&#22120;&#19978;&#30331;&#24405;10.148.151.98:1888&#65292;&#28982;&#21518;&#22312;server&#19978;&#26597;&#30475;&#36827;&#31243;ps -ef | grep p4d&#65292;&#22914;&#19979;&#65306; </p>&#13;
<p>perforce 11778 11776&#160; 0 19:20 ?&#160;&#160;&#160;&#160;&#160;&#160;&#160; 00:00:00 p4d -i -L /local/perforce/log/p4server001.log -r /local/perforce/p4root -p 10.148.151.98:1888 -J /local/perforce/journal/journal</p>&#13;
<p>&#160;</p>&#13;
<p>&#160;</p>&#13;
<p>&#27880;&#24847;&#65306; xinetd&#30417;&#21548;1666&#31471;&#21475;&#65292;&#28982;&#21518;&#24403;1666&#31471;&#21475;&#26377;&#35831;&#27714;&#26102;&#21551;&#21160;&#30340;p4d&#36816;&#34892;&#22312;1888&#31471;&#21475;&#12290;&#65288;&#36825;&#37324;&#19981;&#30693;&#36947;&#20026;&#21861;&#24819;&#35774;&#32622;server&#36816;&#34892;&#22312;1666&#30340;&#26102;&#20505;&#32769;&#26159;&#36215;&#19981;&#26469;&#65289;</p>&#13;
<p>&#160;</p>&#13;
<p>&#23436;&#65281;</p>&#13;
</div></body></html>