<!DOCTYPE html>
    <html lang="zh-cn">
    <head>
    <meta charset="utf-8"/>
    <title>
    <meta name="authors" content="" />perforce python的使用</title></head><body>From:<a href=http://www.cnblogs.com/itech/archive/2011/09/14/2176455.html#FeedBack>http://www.cnblogs.com/itech/archive/2011/09/14/2176455.html#FeedBack</a><br><br><div><p>&#19968; p4&#30340;API&#25903;&#25345;&#20960;&#20046;&#25152;&#26377;&#30340;&#24120;&#29992;&#30340;&#35821;&#35328;<br>1&#65289;&#26597;&#30475;p4 API &#20027;&#39029;&#65306; <a href="http://www.perforce.com/perforce/loadsupp.html#api" target="_blank">http://www.perforce.com/perforce/loadsupp.html#api</a>&#160;&#65288;&#21253;&#21547;&#19979;&#36733; &#21644; p4script.pdf&#65289;</p> <p>2&#65289;&#25903;&#25345;&#20960;&#20046;&#25152;&#26377;&#30340;&#35821;&#35328;&#65306;&#160;</p> <p>Perforce C/C++ API <br>Perforce Java API <br>Perforce Perl API <br>Perforce Ruby API <br>Perforce Python API <br>Perforce PHP API <br>Perforce Objective-C API <br>P4COM, a COM Interface to the Perforce C++ API for Windows</p> <p>&#160;</p> <p>&#20108; p4python</p> <p>1&#65289;&#23433;&#35013;&#65288;&#20197;windows&#20026;&#20363;&#65289;</p> <p>&#19979;&#36733;&#21644;&#23433;&#35013;python2.6&#65307;&#65288;&#21487;&#20197;&#23433;&#35013;activepython&#65289;</p> <p>&#19979;&#36733;&#21644;&#23433;&#35013;p4python26&#65307;&#65288;<a href="ftp://ftp.perforce.com/perforce/r09.2/bin.ntx86/p4python26.exe" target="_blank">ftp://ftp.perforce.com/perforce/r09.2/bin.ntx86/p4python26.exe</a>&#65289;</p> <p>2&#65289;&#23433;&#35013;&#21518;&#65288;C:\Python26\Lib\site-packages&#65289;</p> <p>&#25991;&#20214;&#65306;P4.py + P4.pyc + P4API.pyd +  P4Python-2009.2-py2.6.egg-info&#12290;&#20854;&#20013;P4API.pyd&#20026;python&#23545;p4&#30340;extension&#27169;&#22359;&#65292;&#37324;&#38754;&#23450;&#20041;&#20102; P4API.P4Adapter&#21487;&#24796;&#30475;&#19981;&#21040;&#28304;&#30721;&#65292;P4.py &#37324;&#38754;&#21253;&#21547;&#20102;p4 class&#30340;&#23450;&#20041;&#65292;p4class&#20174;P4API.P4Adapter&#32487;&#25215;&#12290;</p> <p>3&#65289;p4.py</p> <p>&#22312;p4.py&#20013;&#23450;&#20041;&#20102;</p> <p>&#8226; P4<br>&#8226; P4Exception<br>&#8226; DepotFile<br>&#8226; Revision<br>&#8226; Integration<br>&#8226; MergeData<br>&#8226; Spec</p> <p>&#20854;&#20013;&#20027;&#35201;&#30340;p4 class&#23450;&#20041;&#22914;&#19979;&#65306;</p> <p><p>import</p><p>&#160;P4API<br><br></p><p>class</p><p>&#160;P4(P4API.P4Adapter):<br>&#160;&#160;&#160;&#160;</p><p>"""</p><p>Use&#160;this&#160;class&#160;to&#160;communicate&#160;with&#160;a&#160;Perforce&#160;server<br>&#160;&#160;&#160;&#160;<br>&#160;&#160;&#160;&#160;Instances&#160;of&#160;P4&#160;will&#160;use&#160;the&#160;environment&#160;settings&#160;(including&#160;P4CONFIG)<br>&#160;&#160;&#160;&#160;to&#160;determine&#160;the&#160;connection&#160;parameters&#160;such&#160;as&#160;P4CLIENT&#160;and&#160;P4PORT.<br>&#160;&#160;&#160;&#160;<br>&#160;&#160;&#160;&#160;This&#160;attributes&#160;can&#160;also&#160;be&#160;set&#160;separately&#160;before&#160;connecting.<br>&#160;&#160;&#160;&#160;<br>&#160;&#160;&#160;&#160;To&#160;run&#160;any&#160;Perforce&#160;commands,&#160;users&#160;of&#160;this&#160;class&#160;first&#160;need&#160;to&#160;run<br>&#160;&#160;&#160;&#160;the&#160;connect()&#160;method.<br>&#160;&#160;&#160;&#160;<br>&#160;&#160;&#160;&#160;It&#160;is&#160;good&#160;practice&#160;to&#160;disconnect()&#160;after&#160;the&#160;program&#160;is&#160;complete.<br>&#160;&#160;&#160;&#160;</p><p>"""</p><p><br>&#160;&#160;&#160;&#160;</p><p>#</p><p>&#160;Constants&#160;useful&#160;for&#160;exception_level</p><p><br></p><p>&#160;&#160;&#160;&#160;</p><p>#</p><p>&#160;RAISE_ALL:&#160;&#160;&#160;&#160;&#160;Errors&#160;and&#160;Warnings&#160;are&#160;raised&#160;as&#160;exceptions&#160;(default)</p><p><br></p><p>&#160;&#160;&#160;&#160;</p><p>#</p><p>&#160;RAISE_ERROR:&#160;&#160;&#160;Only&#160;Errors&#160;are&#160;raised&#160;as&#160;exceptions</p><p><br></p><p>&#160;&#160;&#160;&#160;</p><p>#</p><p>&#160;RAISE_NONE:&#160;&#160;&#160;&#160;No&#160;exceptions&#160;are&#160;raised,&#160;instead&#160;False&#160;is&#160;returned</p><p><br></p><p>&#160;&#160;&#160;&#160;<br>&#160;&#160;&#160;&#160;RAISE_ALL&#160;</p><p>=</p>&#160;<p>2</p><p><br>&#160;&#160;&#160;&#160;RAISE_ERROR&#160;</p><p>=</p>&#160;<p>1</p><p><br>&#160;&#160;&#160;&#160;RAISE_NONE&#160;</p><p>=</p><p>&#160;0<br>&#160;&#160;&#160;&#160;<br>&#160;&#160;&#160;&#160;</p><p>def</p>&#160;<p>__init__</p><p>(self,&#160;</p><p>*</p><p>args,&#160;</p><p>**</p><p>kwlist):&#160;<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;P4API.P4Adapter.</p><p>__init__</p><p>(self,&#160;</p><p>*</p><p>args,&#160;</p><p>**</p><p>kwlist)<br><br>&#160;&#160;&#160;&#160;</p><p>def</p>&#160;<p>__del__</p><p>(self):<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;</p><p>if</p><p>&#160;self.debug&#160;</p><p>&gt;</p>&#160;<p>3</p><p>:<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;</p><p>print</p>&#160;<p>&gt;&gt;</p><p>sys.stderr,&#160;</p><p>"</p><p>P4.__del__()</p><p>"</p><p><br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<br>&#160;&#160;&#160;&#160;</p><p>#</p><p>&#160;store&#160;the&#160;references&#160;to&#160;the&#160;created&#160;lambdas&#160;as&#160;a&#160;weakref&#160;to&#160;allow&#160;Python&#160;</p><p><br></p><p>&#160;&#160;&#160;&#160;</p><p>#</p><p>&#160;to&#160;clean&#160;up&#160;the&#160;garbage.&#160;|The&#160;lambda&#160;as&#160;a&#160;closure&#160;stores&#160;a&#160;reference&#160;to&#160;self</p><p><br></p><p>&#160;&#160;&#160;&#160;</p><p>#</p><p>&#160;which&#160;causes&#160;a&#160;circular&#160;reference&#160;problem&#160;without&#160;the&#160;weakref</p><p><br></p><p>&#160;&#160;&#160;&#160;<br>&#160;&#160;&#160;&#160;</p><p>def</p>&#160;<p>__getattr__</p><p>(self,&#160;name):<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;</p><p>if</p><p>&#160;name.startswith(</p><p>"</p><p>run_</p><p>"</p><p>):<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;cmd&#160;</p><p>=</p><p>&#160;name[len(</p><p>"</p><p>run_</p><p>"</p><p>):]<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;</p><p>return</p>&#160;<p>lambda</p>&#160;<p>*</p><p>args:&#160;self.run(cmd,&#160;</p><p>*</p><p>args)<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;</p><p>elif</p><p>&#160;name.startswith(</p><p>"</p><p>delete_</p><p>"</p><p>):<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;cmd&#160;</p><p>=</p><p>&#160;name[len(</p><p>"</p><p>delete_</p><p>"</p><p>):]<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;</p><p>return</p>&#160;<p>lambda</p>&#160;<p>*</p><p>args:&#160;self.run(cmd,&#160;</p><p>"</p><p>-d</p><p>"</p><p>,&#160;</p><p>*</p><p>args)<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;</p><p>elif</p><p>&#160;name.startswith(</p><p>"</p><p>fetch_</p><p>"</p><p>):<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;cmd&#160;</p><p>=</p><p>&#160;name[len(</p><p>"</p><p>fetch_</p><p>"</p><p>):]<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;</p><p>return</p>&#160;<p>lambda</p>&#160;<p>*</p><p>args:&#160;self.run(cmd,&#160;</p><p>"</p><p>-o</p><p>"</p><p>,&#160;</p><p>*</p><p>args)[0]<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;</p><p>elif</p><p>&#160;name.startswith(</p><p>"</p><p>save_</p><p>"</p><p>):<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;cmd&#160;</p><p>=</p><p>&#160;name[len(</p><p>"</p><p>save_</p><p>"</p><p>):]<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;</p><p>return</p>&#160;<p>lambda</p>&#160;<p>*</p><p>args:&#160;self.</p><p>__save</p><p>(cmd,&#160;</p><p>*</p><p>args)<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;</p><p>elif</p><p>&#160;name.startswith(</p><p>"</p><p>parse_</p><p>"</p><p>):<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;cmd&#160;</p><p>=</p><p>&#160;name[len(</p><p>"</p><p>parse_</p><p>"</p><p>):]<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;</p><p>return</p>&#160;<p>lambda</p>&#160;<p>*</p><p>args:&#160;self.parse_spec(cmd,&#160;</p><p>*</p><p>args)<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;</p><p>elif</p><p>&#160;name.startswith(</p><p>"</p><p>format_</p><p>"</p><p>):<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;cmd&#160;</p><p>=</p><p>&#160;name[len(</p><p>"</p><p>format_</p><p>"</p><p>):]<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;</p><p>return</p>&#160;<p>lambda</p>&#160;<p>*</p><p>args:&#160;self.format_spec(cmd,&#160;</p><p>*</p><p>args)<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;</p><p>else</p><p>:<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;</p><p>raise</p><p>&#160;AttributeError,&#160;name<br>&#160;&#160;&#160;&#160;<br>&#160;&#160;&#160;&#160;</p><p>def</p>&#160;<p>__save</p><p>(self,&#160;cmd,&#160;</p><p>*</p><p>args):<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;self.input&#160;</p><p>=</p><p>&#160;args[0]<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;</p><p>return</p><p>&#160;self.run(cmd,&#160;</p><p>"</p><p>-i</p><p>"</p><p>,&#160;args[</p><p>1</p><p>:])<br>&#160;&#160;&#160;&#160;<br>&#160;&#160;&#160;&#160;</p><p>def</p>&#160;<p>__repr__</p><p>(self):<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;state&#160;</p><p>=</p>&#160;<p>"</p><p>disconnected</p><p>"</p><p><br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;</p><p>if</p><p>&#160;self.connected():<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;state&#160;</p><p>=</p>&#160;<p>"</p><p>connected</p><p>"</p><p><br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;</p><p>return</p>&#160;<p>"</p><p>P4&#160;[%s@%s&#160;%s]&#160;%s</p><p>"</p>&#160;<p>%</p><p>&#160;\<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;(self.user,&#160;self.client,&#160;self.port,&#160;state)<br>&#160;&#160;&#160;&#160;<br>&#160;&#160;&#160;&#160;</p><p>def</p><p>&#160;identify(cls):<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;</p><p>return</p><p>&#160;P4API.identify()<br>&#160;&#160;&#160;&#160;identify&#160;</p><p>=</p><p>&#160;classmethod(identify)<br>&#160;&#160;&#160;&#160;<br>&#160;&#160;&#160;&#160;</p><p>def</p><p>&#160;run(self,&#160;</p><p>*</p><p>args):<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;</p><p>"</p><p>Generic&#160;run&#160;method</p><p>"</p><p><br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;</p><p>return</p><p>&#160;P4API.P4Adapter.run(self,&#160;</p><p>*</p><p>self.</p><p>__flatten</p><p>(args))<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<br>&#160;&#160;&#160;&#160;</p><p>def</p><p>&#160;run_submit(self,&#160;</p><p>*</p><p>args):<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;</p><p>"</p><p>Simplified&#160;submit&#160;-&#160;if&#160;any&#160;arguments&#160;is&#160;a&#160;dict,&#160;assume&#160;it&#160;to&#160;be&#160;the&#160;changeform</p><p>"</p><p><br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;nargs&#160;</p><p>=</p><p>&#160;list(args)<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;form&#160;</p><p>=</p><p>&#160;None<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;</p><p>for</p><p>&#160;n,&#160;arg&#160;</p><p>in</p><p>&#160;enumerate(nargs):<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;</p><p>if</p><p>&#160;isinstance(&#160;arg,&#160;dict):<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;self.input&#160;</p><p>=</p><p>&#160;arg<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;nargs.pop(n)<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;nargs.append(</p><p>"</p><p>-i</p><p>"</p><p>)<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;</p><p>break</p><p><br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;</p><p>return</p><p>&#160;self.run(</p><p>"</p><p>submit</p><p>"</p><p>,&#160;</p><p>*</p><p>nargs)<br>&#160;&#160;&#160;&#160;<br>&#160;&#160;&#160;&#160;</p><p>def</p><p>&#160;run_login(self,&#160;</p><p>*</p><p>args):<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;</p><p>"</p><p>Simple&#160;interface&#160;to&#160;make&#160;login&#160;easier</p><p>"</p><p><br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;self.input&#160;</p><p>=</p><p>&#160;self.password<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;</p><p>return</p><p>&#160;self.run(</p><p>"</p><p>login</p><p>"</p><p>,&#160;</p><p>*</p><p>args)<br><br>&#160;&#160;&#160;&#160;</p><p>def</p><p>&#160;run_password(&#160;self,&#160;oldpass,&#160;newpass&#160;):<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;</p><p>"</p><p>Simple&#160;interface&#160;to&#160;allow&#160;setting&#160;of&#160;the&#160;password</p><p>"</p><p><br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;</p><p>if</p><p>(&#160;oldpass&#160;</p><p>and</p><p>&#160;len(oldpass)&#160;</p><p>&gt;</p><p>&#160;0&#160;):<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;self.input&#160;</p><p>=</p><p>&#160;[&#160;oldpass,&#160;newpass,&#160;newpass&#160;]<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;</p><p>else</p><p>:<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;self.input&#160;</p><p>=</p><p>&#160;[&#160;newpass,&#160;newpass&#160;]<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;</p><p>return</p><p>&#160;self.run(&#160;</p><p>"</p><p>password</p><p>"</p><p>&#160;)<br><br>&#160;&#160;&#160;&#160;</p><p>#<br></p><p>&#160;&#160;&#160;&#160;</p><p>#</p><p>&#160;run_filelog:&#160;convert&#160;"p4&#160;filelog"&#160;responses&#160;into&#160;objects&#160;with&#160;useful</p><p><br></p><p>&#160;&#160;&#160;&#160;</p><p>#</p><p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;methods</p><p><br></p><p>&#160;&#160;&#160;&#160;</p><p>#<br></p><p>&#160;&#160;&#160;&#160;</p><p>#</p><p>&#160;Requires&#160;tagged&#160;output&#160;to&#160;be&#160;of&#160;any&#160;real&#160;use.&#160;If&#160;tagged&#160;output&#160;it&#160;not&#160;</p><p><br></p><p>&#160;&#160;&#160;&#160;</p><p>#</p><p>&#160;enabled&#160;then&#160;you&#160;just&#160;get&#160;the&#160;raw&#160;data&#160;back</p><p><br></p><p>&#160;&#160;&#160;&#160;</p><p>#<br></p><p>&#160;&#160;&#160;&#160;</p><p>def</p><p>&#160;run_filelog(&#160;self,&#160;</p><p>*</p><p>args&#160;):<br>&#160;&#160;&#160;&#160;&#160;&#160;raw&#160;</p><p>=</p><p>&#160;self.run(&#160;</p><p>'</p><p>filelog</p><p>'</p><p>,&#160;args&#160;)<br>&#160;&#160;&#160;&#160;&#160;&#160;</p><p>if</p><p>&#160;(</p><p>not</p><p>&#160;self.tagged):&#160;<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;</p><p>#</p><p>&#160;untagged&#160;mode&#160;returns&#160;simple&#160;strings,&#160;which&#160;breaks&#160;the&#160;code&#160;below</p><p><br></p><p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;</p><p>return</p><p>&#160;raw<br>&#160;&#160;&#160;&#160;&#160;&#160;result&#160;</p><p>=</p><p>&#160;[]<br>&#160;&#160;&#160;&#160;&#160;&#160;</p><p>for</p><p>&#160;h&#160;</p><p>in</p><p>&#160;raw:<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;r&#160;</p><p>=</p><p>&#160;None<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;</p><p>if</p><p>&#160;isinstance(&#160;h,&#160;dict&#160;):<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;df&#160;</p><p>=</p><p>&#160;DepotFile(&#160;h[&#160;</p><p>"</p><p>depotFile</p><p>"</p><p>&#160;]&#160;)<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;</p><p>for</p><p>&#160;n,&#160;rev&#160;</p><p>in</p><p>&#160;enumerate(&#160;h[&#160;</p><p>"</p><p>rev</p><p>"</p><p>&#160;]):<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;</p><p>#</p><p>&#160;Create&#160;a&#160;new&#160;revision&#160;of&#160;this&#160;file&#160;ready&#160;for&#160;populating</p><p><br></p><p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;r&#160;</p><p>=</p><p>&#160;df.new_revision()<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;</p><p>#</p><p>&#160;Populate&#160;the&#160;base&#160;attributes&#160;of&#160;each&#160;revision</p><p><br></p><p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;r.rev&#160;</p><p>=</p><p>&#160;int(&#160;rev&#160;)<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;r.change&#160;</p><p>=</p><p>&#160;int(&#160;h[&#160;</p><p>"</p><p>change</p><p>"</p><p>&#160;][&#160;n&#160;]&#160;)<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;r.action&#160;</p><p>=</p><p>&#160;h[&#160;</p><p>"</p><p>action</p><p>"</p><p>&#160;][&#160;n&#160;]&#160;<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;r.type&#160;</p><p>=</p><p>&#160;h[&#160;</p><p>"</p><p>type</p><p>"</p><p>&#160;][&#160;n&#160;]<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;r.time&#160;</p><p>=</p><p>&#160;datetime.datetime.utcfromtimestamp(&#160;int(&#160;h[&#160;</p><p>"</p><p>time</p><p>"</p><p>&#160;][&#160;n&#160;])&#160;)<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;r.user&#160;</p><p>=</p><p>&#160;h[&#160;</p><p>"</p><p>user</p><p>"</p><p>&#160;][&#160;n&#160;]<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;r.client&#160;</p><p>=</p><p>&#160;h[&#160;</p><p>"</p><p>client</p><p>"</p><p>&#160;][&#160;n&#160;]<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;r.desc&#160;</p><p>=</p><p>&#160;h[&#160;</p><p>"</p><p>desc</p><p>"</p><p>&#160;][&#160;n&#160;]<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;</p><p>if</p>&#160;<p>"</p><p>digest</p><p>"</p>&#160;<p>in</p><p>&#160;h:<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;r.digest&#160;</p><p>=</p><p>&#160;h[&#160;</p><p>"</p><p>digest</p><p>"</p><p>&#160;][&#160;n&#160;]<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;</p><p>if</p>&#160;<p>"</p><p>fileSize</p><p>"</p>&#160;<p>in</p><p>&#160;h:<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;r.fileSize&#160;</p><p>=</p><p>&#160;h[&#160;</p><p>"</p><p>fileSize</p><p>"</p><p>&#160;][&#160;n&#160;]<br><br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;</p><p>#</p><p>&#160;Now&#160;if&#160;there&#160;are&#160;any&#160;integration&#160;records&#160;for&#160;this&#160;revision,</p><p><br></p><p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;</p><p>#</p><p>&#160;add&#160;them&#160;in&#160;too</p><p><br></p><p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;</p><p>if</p><p>&#160;(</p><p>not</p>&#160;<p>"</p><p>how</p><p>"</p>&#160;<p>in</p><p>&#160;h)&#160;</p><p>or</p><p>&#160;(n&#160;</p><p>&gt;=</p><p>&#160;len(h[</p><p>"</p><p>how</p><p>"</p><p>])&#160;</p><p>or</p><p>&#160;h[</p><p>"</p><p>how</p><p>"</p><p>][n]&#160;</p><p>==</p><p>&#160;None):<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;</p><p>continue</p><p><br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;</p><p>else</p><p>:<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;</p><p>for</p><p>&#160;m,&#160;how&#160;</p><p>in</p><p>&#160;enumerate(&#160;h[&#160;</p><p>"</p><p>how</p><p>"</p><p>&#160;][&#160;n&#160;]&#160;):<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;file&#160;</p><p>=</p><p>&#160;h[&#160;</p><p>"</p><p>file</p><p>"</p><p>&#160;][&#160;n&#160;][&#160;m&#160;]<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;srev&#160;</p><p>=</p><p>&#160;string.lstrip(h[&#160;</p><p>"</p><p>srev</p><p>"</p><p>&#160;][&#160;n&#160;][&#160;m&#160;],&#160;</p><p>'</p><p>#</p><p>'</p><p>)<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;erev&#160;</p><p>=</p><p>&#160;string.lstrip(h[&#160;</p><p>"</p><p>erev</p><p>"</p><p>&#160;][&#160;n&#160;][&#160;m&#160;],&#160;</p><p>'</p><p>#</p><p>'</p><p>)<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;</p><p>if</p><p>&#160;srev&#160;</p><p>==</p>&#160;<p>"</p><p>none</p><p>"</p><p>:<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;srev&#160;</p><p>=</p><p>&#160;0<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;</p><p>else</p><p>:<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;srev&#160;</p><p>=</p><p>&#160;int(&#160;srev&#160;)<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;</p><p>if</p><p>&#160;erev&#160;</p><p>==</p>&#160;<p>"</p><p>none</p><p>"</p><p>:<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;erev&#160;</p><p>=</p><p>&#160;0<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;</p><p>else</p><p>:<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;erev&#160;</p><p>=</p><p>&#160;int(&#160;erev&#160;)<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;r.integration(&#160;how,&#160;file,&#160;srev,&#160;erev&#160;)<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;</p><p>else</p><p>:<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;r&#160;</p><p>=</p><p>&#160;h<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;result.append(&#160;df&#160;)<br>&#160;&#160;&#160;&#160;&#160;&#160;</p><p>return</p><p>&#160;result<br><br>&#160;&#160;&#160;&#160;</p><p>def</p><p>&#160;run_print(self,&#160;</p><p>*</p><p>args):<br>&#160;&#160;&#160;&#160;&#160;&#160;raw&#160;</p><p>=</p><p>&#160;self.run(</p><p>'</p><p>print</p><p>'</p><p>,&#160;args)<br>&#160;&#160;&#160;&#160;&#160;&#160;result&#160;</p><p>=</p><p>&#160;[raw.pop(0),&#160;</p><p>""</p><p>]<br>&#160;&#160;&#160;&#160;&#160;&#160;<br>&#160;&#160;&#160;&#160;&#160;&#160;</p><p>for</p><p>&#160;line&#160;</p><p>in</p><p>&#160;raw:<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;result[</p><p>-</p><p>1</p><p>]&#160;</p><p>+=</p><p>&#160;line<br>&#160;&#160;&#160;&#160;&#160;&#160;</p><p>return</p><p>&#160;result<br>&#160;&#160;&#160;&#160;<br>&#160;&#160;&#160;&#160;</p><p>def</p><p>&#160;run_resolve(self,&#160;</p><p>*</p><p>args,&#160;</p><p>**</p><p>kargs):<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;myResolver&#160;</p><p>=</p><p>&#160;Resolver()<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;</p><p>if</p>&#160;<p>"</p><p>resolver</p><p>"</p>&#160;<p>in</p><p>&#160;kargs:&#160;<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;myResolver&#160;</p><p>=</p><p>&#160;kargs[</p><p>"</p><p>resolver</p><p>"</p><p>]<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;savedResolver&#160;</p><p>=</p><p>&#160;self.resolver<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;self.resolver&#160;</p><p>=</p><p>&#160;myResolver<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;result&#160;</p><p>=</p><p>&#160;self.run(</p><p>"</p><p>resolve</p><p>"</p><p>,&#160;args)<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;self.resolver&#160;</p><p>=</p><p>&#160;savedResolver<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;</p><p>return</p><p>&#160;result<br>&#160;&#160;&#160;&#160;<br>&#160;&#160;&#160;&#160;</p><p>def</p>&#160;<p>__flatten</p><p>(self,&#160;args):<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;result&#160;</p><p>=</p><p>&#160;[]<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;</p><p>if</p><p>&#160;isinstance(args,&#160;tuple)&#160;</p><p>or</p><p>&#160;isinstance(args,&#160;list):<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;</p><p>for</p><p>&#160;i&#160;</p><p>in</p><p>&#160;args:<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;result.extend(self.</p><p>__flatten</p><p>(i))<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;</p><p>else</p><p>:<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;result.append(args)<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;</p><p>return</p><p>&#160;tuple(result)<br><br>&#160;&#160;&#160;&#160;</p><p>def</p>&#160;<p>__enter__</p><p>(&#160;self&#160;):<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;</p><p>return</p><p>&#160;self<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<br>&#160;&#160;&#160;&#160;</p><p>def</p>&#160;<p>__exit__</p><p>(&#160;self,&#160;exc_type,&#160;exc_val,&#160;exc_tb&#160;):<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;</p><p>if</p><p>&#160;self.connected():<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;self.disconnect()<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;</p><p>return</p><p>&#160;True<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<br>&#160;&#160;&#160;&#160;</p><p>def</p><p>&#160;connect(&#160;self&#160;):<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;P4API.P4Adapter.connect(&#160;self&#160;)<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;</p><p>return</p><p>&#160;self<br>&#160;&#160;&#160;&#160;<br>&#160;&#160;&#160;&#160;@contextmanager<br>&#160;&#160;&#160;&#160;</p><p>def</p><p>&#160;while_tagged(&#160;self,&#160;t&#160;):<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;old&#160;</p><p>=</p><p>&#160;self.tagged<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;self.tagged&#160;</p><p>=</p><p>&#160;t<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;</p><p>yield</p><p><br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;self.tagged&#160;</p><p>=</p><p>&#160;old<br>&#160;&#160;&#160;&#160;<br>&#160;&#160;&#160;&#160;@contextmanager<br>&#160;&#160;&#160;&#160;</p><p>def</p><p>&#160;at_exception_level(&#160;self,&#160;e&#160;):<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;old&#160;</p><p>=</p><p>&#160;self.exception_level<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;self.exception_level&#160;</p><p>=</p><p>&#160;e<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;</p><p>yield</p><p><br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;self.exception_level&#160;</p><p>=</p><p>&#160;old<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<br>&#160;&#160;&#160;&#160;@contextmanager<br>&#160;&#160;&#160;&#160;</p><p>def</p><p>&#160;saved_context(&#160;self&#160;,&#160;</p><p>**</p><p>kargs):<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;</p><p>"""</p><p>Saves&#160;the&#160;context&#160;of&#160;this&#160;p4&#160;object&#160;and&#160;restores&#160;it&#160;again&#160;at&#160;the&#160;end&#160;of&#160;the&#160;block</p><p>"""</p><p><br>&#160;&#160;&#160;&#160;<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;saved_context&#160;</p><p>=</p><p>&#160;{}<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;</p><p>for</p><p>&#160;attr&#160;</p><p>in</p><p>&#160;self.</p><p>__members__</p><p>:<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;saved_context[attr]&#160;</p><p>=</p><p>&#160;getattr(self,&#160;attr)<br>&#160;&#160;&#160;&#160;<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;</p><p>for</p><p>&#160;(k,v)&#160;</p><p>in</p><p>&#160;kargs.items():<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;setattr(&#160;self,&#160;k,&#160;v)<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;</p><p>yield</p><p><br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;</p><p>#</p><p>&#160;now&#160;restore&#160;the&#160;context&#160;again.&#160;Ignore&#160;AttributeError&#160;exception</p><p><br></p><p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;</p><p>#</p><p>&#160;Exception&#160;is&#160;expected&#160;because&#160;some&#160;attributes&#160;only&#160;have&#160;getters,&#160;no&#160;setters</p><p><br></p><p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;</p><p>for</p><p>&#160;(k,v)&#160;</p><p>in</p><p>&#160;saved_context.items():<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;</p><p>try</p><p>:<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;setattr(&#160;self,&#160;k,&#160;v&#160;)<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;</p><p>except</p><p>&#160;AttributeError:<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;</p><p>pass</p>&#160;<p>#</p><p>&#160;expected&#160;for&#160;server_level&#160;and&#160;p4config_file</p></p><p>&#160;</p> <p>&#19977; &#23454;&#20363;</p> <p>1&#65289;p4info.py</p> <p><p>from</p><p>&#160;P4&#160;</p><p>import</p><p>&#160;P4,P4Exception&#160;<br><br>p4&#160;</p><p>=</p><p>&#160;P4()&#160;<br>p4.port&#160;</p><p>=</p>&#160;<p>"</p><p>localhost:1666</p><p>"</p><p><br>p4.user&#160;</p><p>=</p>&#160;<p>"</p><p>AAA</p><p>"</p><p><br>p4.password&#160;</p><p>=</p>&#160;<p>"</p><p>aaa</p><p>"</p><p><br>p4.client&#160;</p><p>=</p>&#160;<p>"</p><p>TestProject_AAA</p><p>"</p><p>&#160;<br><br></p><p>try</p><p>:&#160;<br>&#160;&#160;p4.connect()&#160;<br>&#160;&#160;info&#160;</p><p>=</p><p>&#160;p4.run(</p><p>"</p><p>info</p><p>"</p><p>)&#160;<br>&#160;&#160;</p><p>for</p><p>&#160;key&#160;</p><p>in</p><p>&#160;info[0]:&#160;<br>&#160;&#160;&#160;&#160;</p><p>print</p><p>&#160;key,&#160;</p><p>"</p><p>=</p><p>"</p><p>,&#160;info[0][key]<br>&#160;&#160;p4.disconnect()&#160;<br></p><p>except</p><p>&#160;P4Exception:<br>&#160;&#160;</p><p>for</p><p>&#160;e&#160;</p><p>in</p><p>&#160;p4.errors:&#160;<br>&#160;&#160;&#160;&#160;</p><p>print</p><p>&#160;e</p></p><p>&#32467;&#26524;&#65306;</p> <p><img alt="" src="http://images.cnblogs.com/cnblogs_com/itech/192594/pyp4info.png" height="246" width="538" border="0"></p> <p>&#160;</p> <p>2&#65289;p4sync.py&#160;</p> <p><p>from</p><p>&#160;P4&#160;</p><p>import</p><p>&#160;P4,&#160;P4Exception<br><br>p4&#160;</p><p>=</p><p>&#160;P4()&#160;<br>p4.port&#160;</p><p>=</p>&#160;<p>"</p><p>localhost:1666</p><p>"</p><p><br>p4.user&#160;</p><p>=</p>&#160;<p>"</p><p>AAA</p><p>"</p><p><br>p4.password&#160;</p><p>=</p>&#160;<p>"</p><p>aaa</p><p>"</p><p><br>p4.client&#160;</p><p>=</p>&#160;<p>"</p><p>TestProject_AAA</p><p>"</p><p>&#160;<br><br></p><p>try</p><p>:<br>&#160;&#160;p4.connect()<br>&#160;&#160;p4.exception_level&#160;</p><p>=</p>&#160;<p>1</p>&#160;<p>#</p><p>&#160;ignore&#160;"File(s)&#160;up-to-date"</p><p><br></p><p>&#160;&#160;files&#160;</p><p>=</p><p>&#160;p4.run_sync()<br>&#160;&#160;</p><p>for</p><p>&#160;file&#160;</p><p>in</p><p>&#160;files:<br>&#160;&#160;&#160;&#160;</p><p>for</p><p>&#160;key&#160;</p><p>in</p><p>&#160;file.keys():<br>&#160;&#160;&#160;&#160;&#160;&#160;</p><p>print</p><p>&#160;key,</p><p>"</p><p>:</p><p>"</p><p>,file[key]<br>&#160;&#160;&#160;&#160;</p><p>print</p>&#160;<p>"</p><p>----------</p><p>"</p><p><br></p><p>except</p><p>&#160;P4Exception:<br>&#160;&#160;</p><p>for</p><p>&#160;e&#160;</p><p>in</p><p>&#160;p4.errors:<br>&#160;&#160;&#160;&#160;</p><p>print</p><p>&#160;e<br></p><p>finally</p><p>:<br>&#160;&#160;p4.disconnect()</p></p><p>&#32467;&#26524;&#65306;</p> <p><img alt="" src="http://images.cnblogs.com/cnblogs_com/itech/192594/pyp4sync.png" height="232" width="515" border="0"></p> <p>&#160;</p> <p>3&#65289;p4submit.py</p> <p><p>from</p><p>&#160;P4&#160;</p><p>import</p><p>&#160;P4<br><br>p4&#160;</p><p>=</p><p>&#160;P4()<br>p4.host&#160;</p><p>=</p>&#160;<p>"</p><p>localhost</p><p>"</p><p><br>p4.port&#160;</p><p>=</p>&#160;<p>"</p><p>1666</p><p>"</p><p><br>p4.user&#160;</p><p>=</p>&#160;<p>"</p><p>AAA</p><p>"</p><p><br>p4.password&#160;</p><p>=</p>&#160;<p>"</p><p>aaa</p><p>"</p><p><br>p4.client&#160;</p><p>=</p>&#160;<p>"</p><p>TestProject_AAA</p><p>"</p><p><br><br>p4.connect()<br>changeSpec&#160;</p><p>=</p><p>&#160;p4.run_change(&#160;</p><p>"</p><p>-o</p><p>"</p><p>&#160;)<br>change&#160;</p><p>=</p><p>&#160;changeSpec[0]<br>change[</p><p>"</p><p>Description</p><p>"</p><p>]&#160;</p><p>=</p>&#160;<p>"</p><p>Autosubmitted&#160;changelist</p><p>"</p><p><br><br>p4.run_edit(</p><p>"</p><p>//depot/TestProject/addfile.txt</p><p>"</p><p>)<br><br>change[</p><p>"</p><p>Files</p><p>"</p><p>]&#160;</p><p>=</p><p>&#160;[</p><p>"</p><p>//depot/TestProject/addfile.txt</p><p>"</p><p>]<br>p4.input&#160;</p><p>=</p><p>&#160;change<br>p4.run_submit(&#160;</p><p>"</p><p>-i</p><p>"</p><p>&#160;)<br>p4.disconnect()</p></p><p>&#160;</p> <p>&#25152;&#26377;&#30340;p4 command &#37117;&#21487;&#20197;&#20351;&#29992;p4.run_command()&#25110;p4.run(command)&#26469;&#35843;&#29992;&#12290;</p> <p>&#160;</p><p>&#22235; &#36229;&#32423;&#35814;&#32454;&#30340;&#24110;&#21161;&#25991;&#26723;&#65306;</p><p><p>http://www.perforce.com/perforce/doc.current/manuals/p4script/03_python.html</p></p>&#160; <p>&#160;</p> <p>&#23436;&#65281;</p></div></body></html>